#率  #样本量

### 1 抽样调查法    

<font color=blue>适用条件：抽样调查设计的诊断试验</font>    

参考《医疗器械临床试验设计指导原则（2018年第6号）》，样本量计算公式为：  
$$n=\frac{Z_{1-\alpha/2}^2P(1-P)}{\Delta^2} \tag{1}$$  
公式中， $n$ 为阳性组/阴性组的样本量， $Z_{1-\alpha/2}$ 为标准正态分布的分位数， $P$ 为灵敏度或特异度的预期值， $\Delta$ 为 $P$ 的允许误差大小，一般取 $P$ 的95%置信区间宽度的一半，常用的取值为 0.05-0.10。  

---
### 2 单组目标值法  

<font color=blue>适用条件：当试验器械技术比较成熟且对其适用疾病有较为深刻的了解时，或者当设置对照在客观上不可行时（例如试验器械与现有治疗方法的风险受益过于悬殊，设置对照在伦理上不可行；又如现有治疗方法因客观条件限制不具有可行性等），方可考虑采用单组目标值设计</font>   

参考《医疗器械临床试验设计指导原则（2018年第6号）》，样本量计算公式为：  
$$n=\frac{[Z_{1-\alpha/2}\sqrt{P_0(1-P_0)}+Z_{1-\beta}\sqrt{P_T(1-P_T)}]^2}{(P_T-P_0)^2} \tag{2}$$  
公式中， $n$ 为试验组样本量， $Z_{1-\alpha/2}$ 、 $Z_{1-\beta}$ 为标准正态分布的分数位， $P_T$ 为试验组预期事件发生率， $P_0$ 为目标值。  

---
### 3 平行对照设计  

##### 3.1 优效性试验  

高优指标检验假设：$H_0:P_T-P_C\le\Delta\ \ \text{versus}\ \ H_1:P_T-P_C\gt\Delta$    
低优指标检验假设：$H_0:P_T-P_C\ge-\Delta\ \ \text{versus}\ \ H_1:P_T-P_C\lt-\Delta$  

低优指标检验假设可转换为：$H_0:P_C-P_T\le\Delta\ \ \text{versus}\ \ H_1:P_C-P_T\gt\Delta$  

因为高优时$P_T-P_C\gt0$，低优时$P_C-P_T\gt0$，所以可将两个检验假设统一为：  
$$H_0:|P_T-P_C|\le\Delta\ \ \text{versus}\ \ H_1:|P_T-P_C|\gt\Delta$$  
###### 3.1.1 平衡设计  

<font color=blue>适用条件：试验组：对照组=1：1，方差齐，且率值不接近于 0% 或 100% 时</font>  

参考《医疗器械临床试验设计指导原则（2018年第6号）》，样本量计算公式（对应PASS Z-test unpooled）为：  
$$n_T=n_C=\frac{(Z_{1-\alpha/2}+Z_{1-\beta})^2[P_C(1-P_C)+P_T(1-P_T)]}{(|D|-\Delta)^2} \tag{3}$$  
公式中， $P_T$ 和 $P_C$ 分别为试验组和对照组预期事件发生率， $|D|=|P_T-P_C|$ 为两组预期率差的绝对值， $\Delta$ 为优效性界值，取正值。

参考<font color=blue>[Julious SA, Campbell MJ. Tutorial in biostatistics: sample sizes for parallel group clinical trials with binary data. Stat Med. 2012 Oct 30;31(24):2904-36. doi: 10.1002/sim.5381. Epub 2012 Jun 19. PMID: 22714646.]</font>，样本量计算公式（对应PASS Z-test pooled）为：  
$$
n_T=n_C=\frac{(Z_{1-\alpha/2}\sqrt{2\bar{P}(1-\bar{P})}+Z_{1-\beta}\sqrt{P_T(1-P_T)+P_C(1-P_C)})^2}{(|D|-\Delta)^2} \tag{4}
$$

###### 3.1.2 非平衡设计  

<font color=blue>适用条件：试验组：对照组=k:1（对应 PASS Z unpooled）</font>    

参考《杨立波.临床试验中平行组设计二分类指标样本量的计算[J].中国新药杂志,2011,20(24):2392-2395.》，样本量计算公式为：  
$$\begin{align}
n_T&=kn_C \\
n_C&=(Z_{1-\alpha/2}\sqrt{P_{T_0}(1-P_{T_0})(1+k)/k}+Z_{1-\beta}\sqrt{P_C(1-P_C)+P_T(1-P_T)/k})^2/(P_C-P_T)^2  \tag{5-1}
\end{align}
$$
  
参考《Sample Size Calculations in Clinical Research, Third Edition》，样本量计算公式为：  
$$\begin{align}
n_T&=kn_C \\
n_C&=\frac{(Z_{1-\alpha/2}+Z_{1-\beta})^2[P_C(1-P_C)+P_T(1-P_T)/k]}{(|D|-\Delta)^2} \tag{5-2}
\end{align}
$$


公式中， $P_C$ 为对照组预期事件发生率， $P_{T_0}$ 为试验组无效假设下预期事件发生率， $P_T$ 为试验组备择假设下预期事件发生率。  

>[!example] 示例
>一项比较参松养心胶囊与心律宁片治疗冠心病室性早搏的临床试验，参松养心胶囊治疗的有效率为70%。假设有一种新的治疗药物，预期这种药物的治疗有效率可达80%，以参松养心胶囊为对照设计一项优效性临床试验，试验组：对照组=1：1。按照 $\alpha$ =0.05 ，$\beta$ = 0.10 ，计算得试验组与对照组各需样本量 392 例。


<font color=blue>适用条件：试验组：对照组=k:1（对应 PASS Z pooled）</font>    

参考PASS15 documentation及《Julious SA, Campbell MJ. Tutorial in biostatistics: sample sizes for parallel group clinical trials with binary data. Stat Med. 2012 Oct 30;31(24):2904-36. doi: 10.1002/sim.5381. Epub 2012 Jun 19. PMID: 22714646.》，样本量计算公式为：

$$\begin{align}
n_T&=kn_C \\
n_C&=\frac{(Z_{1-\alpha/2}\sqrt{\bar{\pi}(1-\bar{\pi})(k+1)/k}+Z_{1-\beta}\sqrt{\pi_T(1-\pi_T)/k+\pi_C(1-\pi_C)})^2}{(|D|-\Delta)^2} \tag{5-3}
\end{align}
$$

其中，$\bar{\pi}=(k\pi_T+\pi_C)/(k+1)$。

##### 3.2 等效性试验  

>[!tip] 等效性检验中 Ⅱ 类错误取值的单双侧分歧   
>参考《于莉莉,夏结来.模拟验证等效性检验中β的单、双侧取值[J].中国卫生统计,2006,(05):407-409+412.》：
>在传统显著性检验中，$\alpha$ 可以取单侧，也可以取双侧，而 $\beta$只取单侧；对于等效性检验，$\alpha$ 取双单侧，那么 $\beta$ 是取单侧、双侧还是双单侧呢？  
>模拟结果：
>- 当试验组与对照组预期有效率差值 $\theta=0$ 时，$\beta$ 取单侧所计算的样本量模拟得到的检验效能大部分接近预先规定的检验效能，$\beta$ 取双侧则会远远超过预先规定的检验效能。  
>- 当试验组与对照组预期有效率差值 $\theta \ne 0$ 时，$\beta$ 取单侧所计算的样本量模拟得到的检验效能基本在预先设定的检验效能左右，$\beta$ 取双侧则远远达不到预先规定的检验效能。  
>- 当 $\beta$ 取双侧时，$1-\beta =0.80$ 相当于 $\beta$ 取单侧时 $1-\beta=0.90$  
>
>因此，有以下结论：
>- 当 $\theta = 0$ 时，$n=2[(Z_{1-\alpha}+Z_{1-\beta/2})(\sigma/(\Delta-\theta))]^2$  
>- 当 $\theta \ne 0$ 时，$n=2[(Z_{1-\alpha}+Z_{1-\beta})(\sigma/(\Delta-\theta))]^2$

>[!tip] PASS计算注意事项  
>对于PASS，$\theta\ne0$时，$\beta$取双侧，即双侧$1-\beta=0.8$时，PASS中$\beta$取值需为“0.8”（PASS输入参数为0.8，计算公式取值也为0.8）；当$\theta=0$时，$\beta$取单侧，即双侧$1-\beta=0.8$时，PASS中$\beta$取值为“0.9”（PASS输入参数为0.8，计算公式取值为0.9）；$\alpha$取双侧，即双侧$\alpha=0.05$时，PASS中$\alpha$取值为0.05。  

###### 3.2.1 平衡设计  

<font color=blue>适用条件：试验组：对照组=1：1，方差齐，率值不接近于 0% 或 100% ，非劣侧界值与优侧界值相等</font>    

参考<冯国双.临床研究中非劣效性和等效性试验的样本量估算[J].慢性病学杂志,2022,23(07):1006-1009+1014.DOI:10.16440/J.CNKI.1674-8166.2022.07.14.>：

差值$|D|\ne0$时，样本量计算公式为：  

$$n_T=n_C=\frac{(Z_{1-\alpha}+Z_{1-\beta})^2[P_C(1-P_C)+P_T(1-P_T)]}{(\Delta-|D|)^2} \tag{6-1}$$  
差值$|D|=0$时，样本量计算公式为：
$$n_T=n_C=\frac{(Z_{1-\alpha}+Z_{1-\beta/2})^2[P_C(1-P_C)+P_T(1-P_T)]}{(\Delta-|D|)^2} \tag{6-2}$$

公式中， $P_T$ 和 $P_C$ 分别为试验组和对照组预期事件发生率， $D=P_T-P_C$ 为两组预期率差值， $\Delta$ 为等效界值（适用于非劣侧界值与优侧界值相等的情形），其符号由试验组与对照组阳性率之差的符号决定。  

>[!example] 示例
>某研究比较某新药与阳性对照药的疗效，根据前期试验，假定试验药和对照药的有效率均为 55% ，拟采用等效性试验，两组按 1：1 的比例分配。等效性界值设定为 15%（优侧与非劣侧均为 15% ） 。问当 $\alpha$ = 0.05 ， $1-\beta$ = 80% 时，共需多少例样本？
>解答：因等效性试验为双侧检验，故需取 $Z_{1-\alpha}$ 而非 $Z_{1-\alpha/2}$，取 $Z_{1-\beta/2}$ 而非 $Z_{1-\beta}$ 以保证 80% 的 power ；将以上参数代入公式，可得每组各需样本量 189 例。

###### 3.2.2 非平衡设计  

<font color=blue>适用条件：试验组：对照组 = k:1 </font>    

参考《Sample Size Calculations in Clinical Research, Third Edition》及<冯国双.临床研究中非劣效性和等效性试验的样本量估算[J].慢性病学杂志,2022,23(07):1006-1009+1014.DOI:10.16440/J.CNKI.1674-8166.2022.07.14.>：

差值$|D|\ne0$时，样本量计算公式为：  
$$\begin{align}
n_T=&kn_C \\
n_C=&\frac{(Z_{1-\alpha}+Z_{1-\beta})^2[P_C(1-P_C)+P_T(1-P_T)/k]}{(\Delta-|D|)^2} \tag{7-1}
\end{align}
$$

差值$|D|=0$时，样本量计算公式为：  
$$\begin{align}
n_T=&kn_C \\
n_C=&\frac{(Z_{1-\alpha}+Z_{1-\beta/2})^2[P_C(1-P_C)+P_T(1-P_T)/k]}{(\Delta-|D|)^2} \tag{7-2}
\end{align}
$$

##### 3.3 非劣效试验  
###### 3.3.1 平衡设计  

<font color=blue>适用条件：试验组：对照组=1：1，方差齐，率值不接近于 0% 或 100%</font>  

参考《医疗器械临床试验设计指导原则（2018年第6号）》，样本量计算公式为：  
$$n_T=n_C=\frac{(Z_{1-\alpha/2}+Z_{1-\beta})^2[P_C(1-P_C)+P_T(1-P_T)]}{(|D|-\Delta)^2} \tag{8}$$  
公式中， $P_T$ 和 $P_C$ 分别为试验组和对照组预期事件发生率， $|D|=|P_T-P_C|$ 为两组预期率差的绝对值， $\Delta$ 为非劣效界值，取负值。  
###### 3.3.2 非平衡设计  

<font color=blue>适用条件：试验组：对照组=k:1</font>  

参考《杨立波.临床试验中平行组设计二分类指标样本量的计算[J].中国新药杂志,2011,20(24):2392-2395.》，样本量计算公式为：  
$$\begin{align}
n_T&=kn_C \\
n_C&=\frac{(Z_{1-\alpha/2}+Z_{1-\beta})^2[P_C(1-P_C)+P_T(1-P_T)/k]}{[(P_C-P_T)-\Delta]^2} \tag{9}
\end{align}
$$  