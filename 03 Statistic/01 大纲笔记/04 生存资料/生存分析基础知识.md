
生存分析（survival analysis）是将事件的结果和出现这一结果所经历的时间结合起来分析的一类统计分析方法。不仅考虑事件是否出现，而且也考虑事件出现的时间长短，因此该类方法也被称之为事件时间分析（time-to-event analysis）。  

## 1 生存分析中的基本概念  

生存分析资料通常采用纵向随访观察获取，和一般资料相比较具有如下特点：  
- 同时考虑生存时间和生存结局；  
- 通常含有删失数据；  
- 生存时间的分布通常不服从正态分布。  

### 1.1 生存时间  

“事件”可细分为起始事件（initial event）与终点事件（terminal event），从起始事件到终点事件之间所经历的时间跨度为生存时间（survival time），常记为随机变量 $T$ ，$T\ge 0$ ，其取值记为 $t$ 。  

生存时间的例子有：  
- 急性白血病患者从发病到死亡所经历的时间跨度；  
- 冠心病患者两次发作之间的时间间隔；  
- 戒烟开始到重新吸烟之间的时间长短；  
- 接触危险因素到发病的时间跨度。  

生存时间的度量单位可以是小时、日、月、年等。起始事件、终点事件、时间单位应在研究设计阶段明确定义。  

生存时间的分布通常不呈正态分布，而呈偏态分布，如呈指数分布、 Weibull 分布、 Gompertz 分布、对数 logistic 分布等。  

### 1.2 删失  

生存结局（status）分为“死亡”与“删失”两类：  
- “死亡”是感兴趣终点事件；  
- 其他终点事件或生存结局都归类为删失（censoring，也称结尾或终检）。  

产生删失的可能原因有：  
- 研究截至日期时，感兴趣事件仍未出现；  
- 因搬迁等原因失去联系，不知感兴趣终点事件何时发生或是否会发生；  
- 因其他各种原因（如患者不配合、医生改变治疗方案等）中途退出；  
- 死于其他”事件“，如死于交通事故或其他疾病。  

##### 1.2.1 删失分类  

删失可细分为：  
- 左删失（left censored）：只知道感兴趣终点事件会在目前知晓时间（如截至时间、失访时间、死于其他疾病时间）之前发生，则称为左删失。  
- 区间删失（interval censored）：只知道感兴趣终点事件会在某一区间内发生，则称为区间删失。    
- 右删失（right censored）：只知道感兴趣终点事件会在知晓时间之后发生，则称为右删失。  

右删失在实际工作中最常见，即大多数情况下获得的删失个体生存时间应该比知晓的时间更长。例如，某个体的生存时间为 1 个月，因为是删失个体，所以该个体至少可以活 1 个月，记为 $t=1^+\text{月}$ ，采用 $+$ 号表示个体为右删失。   

个体的生存时间可以确切获得，称为完全数据（complete data）；个体的生存时间为删失值，得不到确切的生存时间，称为不完全数据（incomplete data）。  

在生存分析研究中，删失值所占的比例不宜太大，且删失的模式应该是随机的。  

### 1.3 生存率  

如果对生存时间直方图拟合一条光滑曲线，则这条曲线就是死亡概率密度函数（probability density function, PDF）曲线，死亡概率密度函数记为 $f(t)$ ，其定义为：  
$$f(t)=\lim_{\Delta t \to 0}\frac{P(t\le T < t+\Delta t)}{\Delta t'} \tag{1}$$  
即所有观察对象在 $t$ 时刻的瞬时死亡率（instantaneous rate）。 $f(t)$ 曲线下全部面积为 1 ，从开始观察到时间 $t$ 为止的曲线下面积就是死亡累计分布函数（cumulative distribution function, CDF）或累计死亡概率，记为 $F(t)$ 。  

时间 $t$ 以右的曲线下面积就是生存累计分布函数或累计生存概率（cumulative survival probability），简称生存率（survival rate）或生存函数（survival function），记为 $S(t)$ 。  

当生存时间 $t=0$ 时， $S(t)=1$ ；如果个体全部“死亡”，则 $S(t)=0$ 。生存率与累计死亡概率之间的关系为：  
$$S(t)=1-F(t) \tag{2}$$  
##### 1.3.1 生存率的计算方法  

如果资料中无删失数据，则生存率为：  
$$S(t)=P(T\ge t)=\frac{t\text{时刻仍存活的例数}}{观察总例数} \tag{3}$$  
若含有删失数据，则需分时段计算生存概率。假定观察对象在各个时段的生存事件独立，应用概率乘法定理将各时段的生存概率相乘得到生存率，即  
$$S(t)=p_1\ \cdot\ p_2\cdots\ p_i\cdots\ p_k=S(t_{k-1}\ \cdot\ p_k) \tag{4}$$  
式中 $p_i(i=1,2,\cdots,k)$ 为各时段的生存概率。  

对于以区间陈列的生存时间资料，可采用 $f(t_i)=[S(t_{i-1})-S(t_i)]/w_i$ 计算死亡概率密度函数值。其中 $w_i$ 为第 $i$ 区间的时间宽度， $S(t_{i-1})$ ， $S(t_i)$ 分别为时间 $t_{i-1}$ 、时间 $t_i$ 的生存率。  

### 1.4 生存概率与死亡概率  
##### 1.4.1 生存概率
生存概率（probability of survival）表示某时段开始时存活的个体，到该时段结束时仍存活的可能性。如年生存概率表示年初尚存人口存活满一年的可能性。  
$$p=\frac{\text{活过该年人数}}{某年年初人口数} \tag{5}$$  
##### 1.4.2 死亡概率  

死亡概率（probability of death）表示某时段开始时存活的个体，在该时段内死亡的可能性。如年死亡概率表示年初尚存人口在今后 1 年内死亡的可能性  
$$q=\frac{\text{该年内死亡人数}}{\text{某年年初人口数}} \tag{6}$$  
显然，死亡概率 $q=1-p$ 。  

死亡概率与一般死亡率（death rate 或 mortality rate）有所不同，如年死亡率  
$$m=\frac{\text{该年内死亡人数}}{\text{某年平均人口数}} \tag{7}$$  
### 1.5 风险函数  

风险率（hazard rate）或风险函数（hazard function）记为 $h(t)$ ，定义为：  
$$h(t)=\lim_{\Delta t \to 0}\frac{P[(t\le T < t+\Delta t)|(T\ge t)]}{\Delta t}=\frac{f(t)}{S(t)} \tag{8}$$  
即已生存到时间 $t$ 的观察对象在 $t$ 时刻的瞬时死亡率。<font color=blue>为非负数，且可以 >1</font> 。  

当 $\Delta t=1$ 时， $h(t)\approx P(t\le T<t+1|T\ge t)$ ，此时的风险率就是时刻 $t$ 存活的个体在此后一个单位时段内的死亡概率。  

累积风险函数（cumulative hazard function）记为 $H(t)$ ，与生存函数之间的关系为：  
$$H(t)=-lnS(t) \tag{9}$$  
对于以区间陈列的生存时间资料，可采用 $h(t_i)=2q_i/[w_i(1+p_i)]$ 计算风险函数。其中 $w_i$ 为第 $i$ 区间的时间宽度， $q_i$ 、 $p_i$ 分别为第 $i$ 区间的死亡概率、生存概率。  

## 2 生存分析的统计方法   
### 2.1 描述分析  

根据样本生存资料估计总体生存率及其他有关指标（如中位生存时间等）。如估计使用某药物的 HIV 阳性患者的生存率、生存曲线以及中位生存时间等。常采用 Kaplan-Meier 法（也叫乘积极限法）进行分析，对于频数表资料则采用寿命表法进行分析。  

计算生存率需考虑生存时间的顺序，属于非参数统计方法。  

### 2.2 比较分析  

对不同组生存率进行比较分析，如比较使用与不用某药物的 HIV 阳性患者的生存率是否有所不同。常采用 log-rank 检验与 Breslow 检验。检验无效假设是两组或多组总体生存时间分布相同，而不对其具体的分布形式做要求，所以也属于非参数统计方法。  

### 2.3 影响因素分析  

通过生存分析模型来探讨影响生存时间的因素，通常以生存时间和生存结局作为应变量，而将其影响因素，比如年龄、性别、药物使用等作为自变量。通过拟合生存分析模型，筛选影响生存时间的保护因素和有害因素。  

方法有半参数法和参数法两类。常用的半参数法为 Cox 比例风险模型。参数法有指数分布法、 Weibull 分布法、 Gompertz 分布法和对数 logistic 分布法等回归模型。  

## 3 生存率的估计与生存曲线    

常采用 Kaplan-Meier 法估计生存率，对于频数表资料可采用寿命表法估计生存率。  

### 3.1 Kaplan-Meier 法  

Kaplan-Meier 法由 Kaplan 和 Meier 于 1958 年提出，该方法也叫乘积极限法（product-limited method）。  

##### 3.1.1 生存率及其标准误  

待补充。
##### 3.1.2 生存曲线  

以生存时间为横轴、生存率为纵轴绘制的阶梯状图形称为 Kaplan-Meier 生存曲线（survival curve），简称 K-M 曲线。  

##### 3.1.3 中位生存时间  

中位生存时间（median survival time）又称为生存时间的中位数，表示刚好有 50% 的个体其存活期大于该时间，是生存分析中最常用的概括性统计量。  

计算中位生存时间的方法有两种，即图解法和线性内插法。  
- 图解法：利用生存曲线图，从纵轴生存率为 0.5 处画一条与横轴平行的线，并与生存率曲线相交，然后自交点画垂线与横轴相交，此交点对应的时间即为中位生存时间。（简单直观，但结果较粗略；在例数较少时，结果的误差较大。）  
- 线性内插法：首先找出两个生存率 $S(t_{i-1})$ 和 $S(t_i)$ ，使得 $S(t_{i-1})>0.5$ ，$S(t_i)<0.5$ ，然后计算中位生存时间。  

### 3.2 寿命表法  

Kaplan-Meier 法，适用于小、大样本，应用非常广泛。如果生存资料没有原始数据，数据已经总结成若干时段的频数表形式，或生存资料样本含量较大，则可采用寿命表（life table）法。  

##### 3.2.1 生存率及其标准误  

待补充。  

##### 3.2.2 生存曲线  

K-M 法估计所有死亡时点的生存率，两个相邻死亡时点之间的生存率都等于前一个较早死亡时点的生存率，因此 K-M 法生存曲线用水平线连接，呈阶梯形。  

寿命表法估计每个时间区间右端点的生存率，因每个时间区间内生存率的变化规律未知，所以寿命表法生存曲线采用折线连接。  

与 K-M 法生存曲线一样，寿命表法生存曲线也可以采用图解法和线性内插法计算其中位生存时间。  

### 3.3 生存率的比较  

